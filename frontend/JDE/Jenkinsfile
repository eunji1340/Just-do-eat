pipeline {
    agent any

    environment {
        APP_NAME = "jde-frontend"
        NGINX_CONTAINER = "JDE-nginx"
        WORK_DIR = "frontend/JDE"
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build Frontend') {
            steps {
                sh '''
                    cd ${WORK_DIR}
                    echo "ğŸ“¦ Installing dependencies..."
                    npm install

                    echo "ğŸ—ï¸ Building frontend..."
                    npm run build
                '''
            }
        }

        stage('Deploy to Nginx') {
            steps {
                sh '''
                    echo "ğŸš€ Deploying build files to Nginx container..."

                    # Nginx ì»¨í…Œì´ë„ˆê°€ ì‹¤ì œ ì„œë¹„ìŠ¤ ë‹´ë‹¹
                    docker cp ${WORK_DIR}/dist/. ${NGINX_CONTAINER}:/usr/share/nginx/html/

                    # nginx reloadë¡œ ìƒˆ íŒŒì¼ ë°˜ì˜
                    docker exec ${NGINX_CONTAINER} nginx -s reload

                    echo "âœ… Deployment completed successfully!"
                '''
            }
        }
    }

    post {
        always {
            echo "ğŸ§¹ Cleaning workspace..."
            cleanWs()
        }
    }
}
