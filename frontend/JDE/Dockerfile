# ---------- 1. Builder Stage (í”„ë¡ íŠ¸ì—”ë“œ ë¹Œë“œ) ----------
FROM node:20 AS builder
WORKDIR /app

# ì˜ì¡´ì„± íŒŒì¼ë§Œ ë¨¼ì € ë³µì‚¬í•˜ì—¬ ìºì‹œ í™œìš©ë„ë¥¼ ë†’ì…ë‹ˆë‹¤.
COPY package*.json ./
RUN npm install

# ëª¨ë“  ì†ŒìŠ¤ ë³µì‚¬ í›„ ë¹Œë“œ ëª…ë ¹ ì‹¤í–‰
COPY . .
RUN npm run build 

# ---------- 2. Runtime Stage (Nginx ë°°í¬) ----------
FROM nginx:1.25-alpine
WORKDIR /usr/share/nginx/html

# Nginxì˜ ê¸°ë³¸ ì›¹ ë£¨íŠ¸(/usr/share/nginx/html)ë¥¼ ë¹„ì›ë‹ˆë‹¤.


# ğŸš¨ ë¹Œë“œ ê²°ê³¼ë¬¼ (dist í´ë”ì˜ ë‚´ìš©)ì„ Nginx ì›¹ ë£¨íŠ¸ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.
# ì´ COPY ëª…ë ¹ì´ 'docker cp'ì™€ 'volume mount'ë¥¼ ëŒ€ì²´í•˜ë©° ì˜¤ë¥˜ë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
COPY --from=builder /app/dist .

# ğŸš¨ Nginx ì„¤ì • íŒŒì¼ì„ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤.
# ì´ ì„¤ì • íŒŒì¼ì€ Dockerfileê³¼ ê°™ì€ ë ˆë²¨(frontend/JDE)ì— ìˆì–´ì•¼ í•©ë‹ˆë‹¤.
COPY default.conf /etc/nginx/conf.d/default.conf

EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]